# Real-Time Notifications Architecture Diagram

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        WasteFreeBD Real-Time Notifications                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER APPLICATIONS  â”‚                    â”‚   ADMIN APPLICATION              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      â”‚                    â”‚                                  â”‚
â”‚  ğŸ“± Home Screen      â”‚                    â”‚  ğŸ“Š Admin Dashboard              â”‚
â”‚    - Request Pickup  â”‚                    â”‚    - Notifications Panel         â”‚
â”‚    - View History    â”‚                    â”‚    - Quick Stats                 â”‚
â”‚                      â”‚                    â”‚    - Mark Complete Button        â”‚
â”‚  ğŸš¨ Alert Screen     â”‚                    â”‚                                  â”‚
â”‚    - Report Full     â”‚                    â”‚  ğŸ”„ Real-Time Listener          â”‚
â”‚    - View Dustbins   â”‚                    â”‚    (NotificationProvider)        â”‚
â”‚                      â”‚                    â”‚                                  â”‚
â”‚  NotificationService â”‚                    â”‚  Consumer Widget                 â”‚
â”‚  â””â”€ send...()        â”‚                    â”‚  â””â”€ rebuilds on change          â”‚
â”‚                      â”‚                    â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                              â”‚
           â”‚ HTTP POST                                    â”‚ Subscribe to changes
           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
           â”‚ â”‚ INSERT notification                    â”‚  â”‚
           â”‚ â”‚ VALUES (title, type, status)          â”‚  â”‚
           â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
           â””â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚â”‚  â”‚
             â”‚          â”‚                           â”‚â”‚  â”‚
             â–¼          â–¼                           â”‚â”‚  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚         SUPABASE / PostgreSQL                  â”‚â”‚â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚â”‚
â”‚                                                 â”‚â”‚â”‚
â”‚  ğŸ“‹ TABLES:                                    â”‚â”‚â”‚
â”‚                                                 â”‚â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚â”‚
â”‚  â”‚ notifications                             â”‚ â”‚â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â”‚â”‚
â”‚  â”‚ id UUID (PK)                             â”‚ â”‚â”‚â”‚
â”‚  â”‚ title TEXT                                â”‚ â”‚â”‚â”‚
â”‚  â”‚ type TEXT (pickup_request|dustbin_full)  â”‚ â”‚â”‚â”‚
â”‚  â”‚ status TEXT (pending|completed)          â”‚ â”‚â”‚â”‚
â”‚  â”‚ created_at TIMESTAMP                     â”‚ â”‚â”‚â”‚
â”‚  â”‚ updated_at TIMESTAMP                     â”‚ â”‚â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚â”‚
â”‚                                                 â”‚â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚â”‚
â”‚  â”‚ notification_audit_log                    â”‚ â”‚â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â”‚â”‚
â”‚  â”‚ (tracks INSERT/UPDATE/DELETE operations) â”‚ â”‚â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚â”‚
â”‚                                                 â”‚â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚â”‚
â”‚  â”‚ dashboard_stats                           â”‚ â”‚â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â”‚â”‚
â”‚  â”‚ pending_issues INT                        â”‚ â”‚â”‚â”‚
â”‚  â”‚ pickups_today INT                         â”‚ â”‚â”‚â”‚
â”‚  â”‚ active_trucks INT                         â”‚ â”‚â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚â”‚
â”‚                                                 â”‚â”‚â”‚
â”‚  ğŸ”§ FUNCTIONS & TRIGGERS:                     â”‚â”‚â”‚
â”‚                                                 â”‚â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚ broadcast_table_changes()                  â”‚â”‚
â”‚  â”‚ â”œâ”€ Fires on: INSERT, UPDATE, DELETE       â”‚â”‚
â”‚  â”‚ â””â”€ Action: Send real-time event           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚                                                 â”‚â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚ log_notification_changes()                 â”‚â”‚
â”‚  â”‚ â”œâ”€ Fires on: INSERT, UPDATE, DELETE       â”‚â”‚
â”‚  â”‚ â””â”€ Action: Log to audit_log               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚                                                 â”‚â”‚â”‚
â”‚  ğŸ“Š VIEWS:                                     â”‚â”‚â”‚
â”‚                                                 â”‚â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚ notification_stats                         â”‚â”‚
â”‚  â”‚ â”œâ”€ total_notifications                    â”‚â”‚
â”‚  â”‚ â”œâ”€ pending_count                          â”‚â”‚
â”‚  â”‚ â”œâ”€ completed_count                        â”‚â”‚
â”‚  â”‚ â””â”€ type breakdown                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚                                                 â”‚â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                                                   â”‚
                    Supabase Realtime             â”‚
                    WebSocket Channel             â”‚
                    (postgres_changes)            â”‚
                          â”‚                       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA FLOW SEQUENCE DIAGRAM                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER APP                           SUPABASE                      ADMIN APP
    â”‚                                  â”‚                             â”‚
    â”‚  1. User sends pickup request    â”‚                             â”‚
    â”‚  â”œâ”€ userId: "user123"            â”‚                             â”‚
    â”‚  â”œâ”€ location: "Dhanmondi"        â”‚                             â”‚
    â”‚  â””â”€ additionalInfo: "Heavy"      â”‚                             â”‚
    â”‚                                  â”‚                             â”‚
    â”‚  2. NotificationService.send()   â”‚                             â”‚
    â”‚  â”‚   (calls Supabase)            â”‚                             â”‚
    â”‚  â”‚                                â”‚                             â”‚
    â”œâ”€ HTTP POST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ notifications.insert()        â”‚
    â”‚                                  â”‚                             â”‚
    â”‚                            3. INSERT TRIGGER FIRES             â”‚
    â”‚                            â”œâ”€ broadcast_table_changes()        â”‚
    â”‚                            â”œâ”€ log_notification_changes()       â”‚
    â”‚                            â””â”€ Event sent via Realtime          â”‚
    â”‚                                  â”‚                             â”‚
    â”‚                                  â”‚  4. Real-time WebSocket      â”‚
    â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
    â”‚                                  â”‚     SUBSCRIBE              â”‚
    â”‚                                  â”‚     â”œâ”€ type: INSERT        â”‚
    â”‚                                  â”‚     â”œâ”€ table: notificationsâ”‚
    â”‚                                  â”‚     â””â”€ data: {title,...}   â”‚
    â”‚                                  â”‚                             â”‚
    â”‚                                  â”‚             5. Parse event â”‚
    â”‚                                  â”‚             â””â”€ Create modelâ”‚
    â”‚                                  â”‚                             â”‚
    â”‚                                  â”‚  6. NotificationProvider    â”‚
    â”‚                                  â”‚  â”œâ”€ _handleNotificationChange
    â”‚                                  â”‚  â”œâ”€ Add to list            â”‚
    â”‚                                  â”‚  â”œâ”€ Update pendingCount     â”‚
    â”‚                                  â”‚  â””â”€ notifyListeners()      â”‚
    â”‚                                  â”‚                             â”‚
    â”‚                                  â”‚       7. UI Updates        â”‚
    â”‚                                  â”‚       â”œâ”€ Consumer rebuilds â”‚
    â”‚                                  â”‚       â”œâ”€ Card appears      â”‚
    â”‚                                  â”‚       â””â”€ Stats +1          â”‚
    â”‚                                  â”‚                             â”‚
    â”‚  â—„ â—„ â—„ Admin clicks Complete â—„ â—„ â—„ â—„ â—„ â—„ â—„ â—„ â—„ â—„ â—„ â—„ â—„ â—„ â—„ â”‚
    â”‚                                  â”‚                             â”‚
    â”‚                          8. Update notification                â”‚
    â”‚                          â””â”€ status = "completed"              â”‚
    â”‚                                  â”‚                             â”‚
    â”‚                          9. Update dashboard_stats            â”‚
    â”‚                          â”œâ”€ pending_issues -1                â”‚
    â”‚                          â”œâ”€ pickups_today +1                 â”‚
    â”‚                          â””â”€ active_trucks +1                 â”‚
    â”‚                                  â”‚                             â”‚
    â”‚                          10. UPDATE TRIGGERS FIRE             â”‚
    â”‚                          â””â”€ broadcast_changes() â†’ Realtime    â”‚
    â”‚                                  â”‚                             â”‚
    â”‚                                  â”‚  11. Real-time event sent  â”‚
    â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
    â”‚                                  â”‚     â”œâ”€ type: UPDATE       â”‚
    â”‚                                  â”‚     â”œâ”€ status: completed  â”‚
    â”‚                                  â”‚     â””â”€ new stats          â”‚
    â”‚                                  â”‚                             â”‚
    â”‚                                  â”‚      12. UI Updates        â”‚
    â”‚                                  â”‚      â”œâ”€ Card removed      â”‚
    â”‚                                  â”‚      â”œâ”€ Stats update      â”‚
    â”‚                                  â”‚      â””â”€ Success message   â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STATE MANAGEMENT FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         NotificationProvider (ChangeNotifier)
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
            State Variables    Methods          Real-time
                    â”‚               â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚- notificationsâ”‚â”‚        â”‚          â”‚    â”‚          â”‚
    â”‚- pendingCount â”‚â”‚        â”‚          â”‚    â”‚  WebSocket
    â”‚- isListening  â”‚â”‚        â”‚          â”‚    â”‚  Channel
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚        â”‚          â”‚    â”‚          â”‚
                    â”‚    â”Œâ”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚    â”‚
              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Initialize  â”‚   â”‚   Handle Change â”‚
    â”‚  Listener()  â”‚   â”‚   _handleNotif..â”‚
    â”‚              â”‚   â”‚                 â”‚
    â”‚ - Connect    â”‚   â”‚ - INSERT:       â”‚
    â”‚   channel    â”‚   â”‚   Add to list   â”‚
    â”‚ - Subscribe  â”‚   â”‚   pendingCount+ â”‚
    â”‚ - Listen     â”‚   â”‚                 â”‚
    â”‚   for events â”‚   â”‚ - UPDATE:       â”‚
    â”‚              â”‚   â”‚   Update model  â”‚
    â”‚              â”‚   â”‚   Adjust count  â”‚
    â”‚              â”‚   â”‚                 â”‚
    â”‚              â”‚   â”‚ - DELETE:       â”‚
    â”‚              â”‚   â”‚   Remove item   â”‚
    â”‚              â”‚   â”‚   pendingCount- â”‚
    â”‚              â”‚   â”‚                 â”‚
    â”‚              â”‚   â”‚ notifyListenersâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚
                Consumer Widget    Rebuild UI
                    â”‚                â”‚
        Dashboard Stat Cards â—„â”€â”€â”€â”˜
        Notification Cards


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         COMPONENT INTERACTION                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

user_screens/
â”œâ”€â”€ pickup_request_example_screen.dart
â”‚   â”œâ”€ UI for users to send pickup request
â”‚   â””â”€ Calls â†’ NotificationService.sendPickupRequestNotification()
â”‚
â””â”€ NotificationService (services/notification_service.dart)
   â”œâ”€ sendPickupRequestNotification()
   â”œâ”€ sendDustbinFullAlert()
   â””â”€ sendNotification()
      â”‚
      â””â”€ Calls â†’ SupabaseService.createNotification()
         â”‚
         â””â”€ INSERT into notifications table

admin_dashboard_screen.dart
â”œâ”€ Provides NotificationProvider context
â”œâ”€ Consumer<NotificationProvider>
â”‚  â”œâ”€ Displays notification cards
â”‚  â”œâ”€ Shows pending count
â”‚  â””â”€ Renders "Mark Complete" buttons
â”‚
â””â”€ notificationProvider.completeNotification()
   â”œâ”€ Updates notification.status
   â”œâ”€ Updates dashboard_stats
   â””â”€ Triggers database broadcasts

NotificationProvider (providers/notification_provider.dart)
â”œâ”€ Real-time listener setup
â”œâ”€ _handleNotificationChange()
â”œâ”€ State: List<NotificationModel>
â””â”€ State: int pendingCount

NotificationCard (admin/widgets/notification_card.dart)
â”œâ”€ Displays individual notification
â”œâ”€ Shows icon based on type
â”œâ”€ Time formatting
â”œâ”€ "Mark Complete" button
â””â”€ Animation on appear/disappear

NotificationModel (models/notification_model.dart)
â”œâ”€ id, title, type, status
â”œâ”€ fromJson() - Supabase data
â””â”€ toJson() - for updates


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE TRANSACTION FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

START TRANSACTION
â”‚
â”œâ”€ INSERT notification
â”‚  â”œâ”€ id: UUID auto-generated
â”‚  â”œâ”€ title: User provided
â”‚  â”œâ”€ type: 'pickup_request' | 'dustbin_full'
â”‚  â”œâ”€ status: 'pending'
â”‚  â””â”€ created_at: NOW()
â”‚
â”œâ”€ TRIGGER: notifications_broadcast_trigger FIRES
â”‚  â”œâ”€ Action: AFTER INSERT
â”‚  â”œâ”€ For EACH ROW
â”‚  â””â”€ Execute broadcast_table_changes()
â”‚     â””â”€ pg_notify() â†’ Sends event on channel
â”‚
â”œâ”€ TRIGGER: notification_audit_trigger FIRES
â”‚  â”œâ”€ Action: AFTER INSERT
â”‚  â”œâ”€ For EACH ROW
â”‚  â””â”€ Execute log_notification_changes()
â”‚     â””â”€ INSERT into notification_audit_log
â”‚
â”œâ”€ Supabase Realtime receives event
â”‚  â””â”€ Broadcasts via WebSocket to subscribers
â”‚
â””â”€ COMMIT

WHEN ADMIN COMPLETES:

START TRANSACTION
â”‚
â”œâ”€ UPDATE notification
â”‚  â”œâ”€ Set status = 'completed'
â”‚  â””â”€ Set updated_at = NOW()
â”‚
â”œâ”€ UPDATE dashboard_stats
â”‚  â”œâ”€ pending_issues -= 1
â”‚  â”œâ”€ pickups_today += 1
â”‚  â”œâ”€ active_trucks += 1
â”‚  â””â”€ updated_at = NOW()
â”‚
â”œâ”€ TRIGGER: notifications_broadcast_trigger FIRES
â”‚  â””â”€ Broadcasts UPDATE event
â”‚
â”œâ”€ TRIGGER: dashboard_stats_broadcast_trigger FIRES
â”‚  â””â”€ Broadcasts stats UPDATE event
â”‚
â”œâ”€ Both audit triggers fire
â”‚  â””â”€ Log changes to audit table
â”‚
â”œâ”€ Supabase Realtime broadcasts both events
â”‚
â””â”€ COMMIT

END
